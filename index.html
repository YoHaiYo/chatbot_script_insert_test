<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>챗봇스크립트 확인 테스트</title>
    <style>
      body {
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <h1>
      <a href="/insert/index.html">스크립트로 삽입된 챗봇 확인하기</a>
    </h1>
    <h3>삽입할 스크립트 주소</h3>
    <p>https://chatbot-script-insert-test.vercel.app/js/insertchatbot.js</p>
    <p>id=d3_company_name 태그안에 삽입되게 처리함.</p>
    <hr />
    <p><a href="/oneline/index.html">스크립트 한줄로 구현하기</a></p>
    <p><a href="/fileupload/index.html">파일업로드 모바일 환경에서 처리</a></p>
    <hr />
    <h3>추가테스트</h3>
    <p><a href="/camera-test/index.html">카메라 테스트</a></p>
    <p><a href="/ocr-test/index.html">OCR 테스트</a></p>

    <script>
      (function () {
        // 스타일 시트 생성 및 추가
        const styleSheet = document.createElement("style");
        styleSheet.innerHTML = `
        #chatbot-wrapper {
          z-index: 9999;
          position: fixed;
          left: 20px;
          bottom: 20px;
          width: 300px;
          height: 300px;
          border: none;
          transition: all 0.3s ease;
        }
        #chatbot-wrapper.expanded {
          width: 600px;
          height: 600px;
        }
        iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `;
        document.head.appendChild(styleSheet);

        // 챗봇 wrapper 생성 및 추가
        const chatbotWrapper = document.createElement("div");
        chatbotWrapper.id = "chatbot-wrapper";

        // iframe 생성 및 추가
        const iframe = document.createElement("iframe");
        iframe.src = "https://namdosobanchatbot.com/company/남도소반/";
        iframe.allow = "microphone";
        chatbotWrapper.appendChild(iframe);

        // 챗봇 wrapper를 body에 추가
        document.body.appendChild(chatbotWrapper);

        // 메시지 수신 핸들러
        window.addEventListener("message", (event) => {
          // 메시지 출처 검증 (iframe URL 도메인)
          if (event.origin !== "https://namdosobanchatbot.com") return;

          const data = event.data;

          // iframe 내부에서 보내는 이벤트 처리
          if (data === "expand-chatbot") {
            chatbotWrapper.classList.add("expanded"); // 크기 확장
          } else if (data === "collapse-chatbot") {
            chatbotWrapper.classList.remove("expanded"); // 크기 축소
          }
        });
      })();
    </script>
  </body>
</html>
